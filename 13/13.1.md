#Работа с графическими изображениями

При работе с файлами изображений, представленных в форматах bmp, png, gif, jpeg, tif и т.д., используются функции чтения

```[X, map] = imread(filename, fmt)```

и записи

```imwrite(X, map, filename, fmt)```

Здесь ```X``` – матрица точек изображения; ```map``` – цветовая карта изображения; ```filename``` – путь к файлу; ```fmt``` – графический формат файла изображения. 

Пример

```[A, map]=imread('1024.bmp','bmp');```

где ```A``` – матрица размером 1024х1024xN точек; ```map``` – цветовая карта загруженного изображения. Значение N показывает число байт, расходуемых на представление точки изображения. Например, если изображение представляется в формате RGB с 24 бит/пиксел, то N=3. Если же загружается изображение с 256 градациями серого (8 бит/пиксел), то N=1.

После обработки изображение A можно обратно сохранить в файл, используя следующую запись:

```imwrite(A, map, 'out_img.bmp', 'bmp');```

В результате в рабочем каталоге MatLab будет сохранено изображение в формате bmp с исходной цветовой картой. Однако следует отметить, что если загруженное изображение ```A``` было преобразовано, например, в формат double

```A = double(A);```

то непосредственная запись такой матрицы как изображение невозможно. Дело в том, что значения матрицы A должны соответствовать целым числам в диапазоне от 0 до 255, т.е. являться байтовыми числами. Этого можно добиться преобразованием типов при записи изображения в файл следующим образом:

```imwrite(uint8(A), map, 'out_img.bmp', 'bmp');```

Здесь uint8 – беззнаковый целый тип в 8 бит.

В качестве переменной map можно указывать любые другие цветовые карты (hot, hsv, gray, pink, cool, bone copper) отличные от исходной. Например, для записи изображения в 256 градациях серого можно записать

```imwrite(uint8(A), gray(256), 'out_img.bmp', 'bmp');```

При этом матрица A должна иметь размерность MxNx1, т.е. один байт на пиксел. 

Для отображения растровых изображений в графическом окне используется функция

```image(A); ```

При работе с изображениями возникают ситуации, когда диапазон значений элементов матрицы A может не соответствовать диапазону значений цветовой карты, например, gray(256). В результате отображения такой матрицы на экране монитора изображение будет показываться некорректно и некоторые его детали будут незаметны. Чтобы избежать такой ситуации, диапазон значений и диапазон цветовой карты должны совпадать. Это можно сделать искусственно, масштабируя соответствующим образом значения элементов матрицы А. Однако MatLab предоставляет функцию

```
imagesc(A);
```

которая делает это автоматически. Благодаря ее использованию, масштаб значений матрицы А всегда будет приведен к масштабу цветовой карты. 

**Геометрические преобразования изображений**

К наиболее распространенным функциям геометрических преобразований относится кадрирование изображений (imcrop), изменение размеров (imresize) и поворот изображения (imrotate).

Суть кадрирования состоит в том, что функция imcrop позволяет с помощью мыши в интерактивном режиме вырезать часть изображения и поместить ее в новое окно просмотра.

````
L=imread('cameraman.tif');
imshow(L);
imcrop;
```
Функция изменения размеров изображения ```imresize``` позволяет, используя специальные методы интерполяции, изменять размер любого типа изображения.

В пакете Image Processing Toolbox существует функция imrotate, которая осуществляет поворот изображения на заданный угол.

```
L1=imrotate(L,35,'bicubic');
figure,imshow(L1)
```
Таким образом, приведенные выше функции позволяют поворачивать, вырезать части, масштабировать, т.е. работать с целым массивом изображения.

**Анализ изображений**

Для работы с отдельными элементами изображений используются такие функции как imhist, impixel, mean2, corr2 и другие.

Одной из наиболее важных характеристик является гистограмма распределения значений интенсивностей пикселей изображения, которую можно построить с помощью функции imhist.

```
L=imread('cameraman.tif');
figure, imshow(L);
figure, imhist(L);
```

Довольно часто при проведении анализа изображений возникает необходимость определить значения интенсивностей некоторых пикселей. Для этого в интерактивном режиме можно использовать функцию impixel.

```
>> impixel

ans =

   173   173   173
   169   169   169
   163   163   163
    39    39    39
```

Еще одной широко применяемой функцией является функция ```mean2``` – она вычисляет среднее значение элементов матрицы.

Функция ```corr2``` вычисляет коэффициент корреляции между двумя матрицами. Другими словами, с помощью функции ```corr2``` можно сказать насколько две матрицы или изображения похожи между собой. Эта функция широко применяется при решении задач распознавания.

**Улучшение изображений**

Среди встроенных функций, которые реализуют наиболее известные методы улучшения изображений, выделим следующие – histeq, imadjust та imfilter(fspecial).

Как уже отмечалось ранее, гистограмма изображения является одной из наиболее информативных характеристик. На основе анализа гистограммы можно судить о яркостных искажениях изображения, т.е. сказать о том, является ли изображение затемненным или засветленным. Известно, что в идеале на цифровом изображении в равном количестве должны присутствовать пиксели со всеми значениями яркостей, т.е. гистограмма должна быть равномерной. Перераспределение яркостей пикселей на изображении с целью получения равномерной гистограммы выполняет метод эквализации, который в системе Matlab реализован в виде функции ```histeq```.

'''
L=imread('cameraman.tif');
figure, imshow(L);
L1=histeq(L);
Figure, imsow(L1);
'''

Довольно часто при формировании изображений не используется весь диапазон значений интенсивностей, что отрицательно отражается на качестве визуальных данных. Для коррекции динамического диапазона сформированных изображений используется функция ```imadjust```.

```
L=imread('cameraman.tif');
figure, imshow(L);
L1=imadjust(L);
figure, imshow(L1);
figure, imhist(L);
figure, imhist(L1);
```
Также при решении задач улучшения изображений используется функция ```imfilter``` в паре с функцией ```fspecial```. Функция ```fspecial``` позволяет задавать различные типы масок фильтра. Рассмотрим пример использования маски фильтра, повышающего резкость изображения.

```
L=imread('cameraman.tif');
figure, imshow(L);
H = fspecial('unsharp');
L1 = imfilter(L,H,'replicate');
figure, imshow(L1);
```
