#Повышение эффективности обработки М-файлов
MATLAB - это язык, специально разработанный для обработки массивов и выполнения матричных операций. 
Всюду, где это возможно, пользователь должен учитывать это обстоятельство.

**Векторизация циклов.**

Под векторизацией понимается преобразование циклов for и while к эквивалентным векторным или матричным выражениям. При векторизации алгоритма ускоряется выполнение M-файла.

Пример

Вот один из способов вычислить 1001 значение функции синуса на интервале [0 10], используя оператор цикла:

```             
                i = 0;

                for t = 0:.01:10
                
                        i = i + 1;
                        
                    y(i) = sin(t);
                    
                end
```  
                
Эквивалентная векторизованная форма имеет вид
             
 ```            
                t = 0:.01:10;
                
                y = sin(t);
``` 
                
В этом случае вычисления выполняются намного быстрее, и такой подход в системе MATLAB является предпочтительным. 
Время выполнения этих М-файлов можно оценить, используя команды ```tic``` и ```toc```.

Пример

Функция repmat - формирование массива из частей - использует преимущество векторизации. 

Она имеет три входных аргумента: массив A, количество строк М и столбцов N для вновь создаваемого массива.

Функция repmat возвращает массив B , который использует массив A в качестве основы для построения блочной матрицы с количеством блоков MxN:

```    
                A = [1 2 3; 4 5 6];
                B = repmat(A, 2, 3);
                B =
                     1 	2 	3 	1 	2 	3 	1 	2 	3
                     4 	5 	6 	4 	5 	6 	4 	5 	6
                     1 	2 	3 	1 	2 	3 	1 	2 	3
                     4 	5 	6 	4 	5 	6 	4 	5 	6

```

**Предварительное выделение памяти.**

В системе MATLAB есть возможность для существенного сокращения времени выполнения программы за счёт предварительного размещения массивов для выходных данных. Предварительное распределение избавляет от необходимости изменять массив при увеличении его размеров. 

Используйте соответствующие функции предварительного выделения памяти, как это показано в таблице для различных типов массивов

Тип массива|Функция|
-------- | ------------|
Массив чисел|zeros|
Массив записей|struct|
Массив ячеек |cell|

Примеры

```
y = zeros(1, 100)
for i = 1:100
  y(i) = det(X^i);
end
```
```
data = struct([1 3], 'x', [1 3], 'y', [5 6])
data(3).x = [9 0 2];
data(3).y = [5 6 7];
```
```
B = cell(2, 3)
B{1, 3} = 1:3;
B{2, 2} = 'string';
```

Предварительное выделение памяти позволяет избежать фрагментации памяти при работе с большими матрицами. 

В ходе сеанса работы системы MATLAB, память может стать фрагментированной из-за работы механизмов динамического распределения и освобождения памяти. Это может привести к появлению большого количества фрагментов свободной памяти, и непрерывного пространства памяти может оказаться недостаточно для хранения какого-либо большого массива.

Предварительное выделение памяти позволяет определить непрерывную область, достаточную для проведения всех вычислений.

**Команды управления памятью**

    clear список_переменных - удаление переменных из рабочей области;
    
    pack - запись текущих переменных на диск и последующей их загрузкой;
    
    функция quit - по мере необходимости выход системы MATLAB с освобождением всей памяти;
    
    save filename - сохранение переменных в файле.
    
    load filename - считывание переменных из файла в рабочую область
    
    save filename -ascii varname - сохранение переменной в текстовый файл
    
    load filename -ascii - считывание переменной из текстового файла в рабочую область
    
    who - список имен переменных рабочей области
    
    whos - список переменных рабочей области с их параметрами

Замечание

Команды save и load работают быстрее, чем утилиты ввода-вывода системы МАТLАВ. Эти команды оптимизированы как по скорости выполнения, так и по возможности фрагментации памяти.

**Переменные и память.** Память выделяется для переменной всякий раз, когда эта переменная не существует.

Для экономии памяти надо:

1.избегать использовать одни и те же переменные в качестве входных и выходных аргументов функции, 
поскольку они будут передаватся ссылкой;

2.после использования переменной целесообразно либо присвоить ей пустой массив, либо удалить с помощью команды clear имя переменной;

3.стремиться использовать переменные повторно.

**Глобальные переменные.** При объявлении глобальной переменной в таблицу переменных просто помещается флаг. При этом не требуется дополнительной памяти.

Например, последовательность операторов ```a = 5; global a```

определяет переменную a как глобальную и формируется дополнительная копия этой переменной.

Функция ```clear a``` удаляет переменную а из рабочей области системы MATLAB, но сохраняет её в области глобальных переменных.

Функция ```clear global a``` удаляет переменную а из области глобальных переменных.

#Средства отладки

```cd directoryname``` - смена текущей папки

```dir``` - вывод в командном окне файлов, находящихся в текущей папке

```diary filename``` - создание дневника(все что будет выводиться в командное окно после команды сохранится в файл)

```diary off``` - отключение режима дневника

```help func``` - информация о функции будет выведена в командное окно

```doc func``` - информация о функции будет выведена в отдельном окне

  ```keyboard``` - команда, написанная в m-файле(сценарии или функции), передает управление командному окну и функция на время перестает выполняться(можно изменять и просматривать значения переменных сценария|функции в окне  Workspace)

После передачи командному окну в нем мы будем видеть приглашение ```K>>```, которое означает, что выполнение программы приостановлено.

```return```, введенная в командном окне при приглашении ```K>>``` означает возврат управления программе.

Если в процессе выполнения программы возникает ошибка, то MATLAB выводит диагностическое сообщение и номер строки, в которой, по мнению пакета, произошла ошибка. Эта информация полезна, но может быть довольно приблизительной, поэтому желательно в процессе отладки программы иметь доступ к переменным для контроля вычислений и просмотра данных.

Для отладки программ и m-функций могут быть полезны следующие простые рекомендации:

1.Удалите подавляющие вывод данных на экран точки с запятой или замените их запятыми. Тогда анализ промежуточных результатов может указать причину неверной работы.

2.Расставьте по тестируемому тексту операторы keyboard. При выполнении этих операторов MATLAB приостановит работу, выведет приглашение, и в режиме интерпретатора можно будет анализировать промежуточные результаты (выводить содержимое интересующих переменных, переопределять величины).

3.Превратите m-функцию в файл script. Закомментируйте описания в начале файла и выполните полученный файл.

Кроме того, в MATLAB имеются специальные возможности для тестирования программ: набор команд отладки и средства редактора-отладчика medit. В этом случае отладка заключается в расстановке точек останова, прогоне программы от точки к точке и просмотре данных. Командный режим отладки является универсальным, поскольку одинаков для различных вычислительных систем, но для среды Windows режим отладки с использованием редактора medit выглядит нагляднее и проще.

**Отладка в командном режиме**

Если отладку проводить при помощи команд среды MATLAB, то для установки и снятия точек останова применяются команды dbstop и dbclear. Каждая из этих команд имеет несколько вариантов применения, в частности команда dbstop еще и задает режимы отладки, a dbclear отменяет назначения. Команды отладки приведены в таблице 2.4.

Команда|Описание
-------|--------
Dbstop|Определить точку останова
Dbclear|Удалить точку (точки) останова
Dbcont|Продолжить выполнение
Dbstep|Выполнить команду отладки
Dbquit|Завершить отладку
dbstack|Список точек останова

**Редактор medit и отладка**

Редактор-отладчик medit обеспечивает удобную среду для подготовки и отладки m – файлов в MATLAB. Файл редактора medit.exe находится в директории \bin и может быть вызван из командного окна MATLAB (пункты New и Open меню Filе, запуск команды edit) или запущен как обычная программа. Редактор-отладчик предоставляет доступ к текстам и данным, в нем можно редактировать m-файлы, вызывать для просмотра и изменения матричные переменные, организовывать отладку программ и функций.

Для просмотра данных из рабочей области следует вызвать Workspace Browser и выбрать (щелкнуть мышкой) нужную переменную. В редакторе откроется новый документ и появится таблица (матрица) с данными, которые можно просмотреть и переопределить. Эта возможность пока предоставляется для скалярных, векторных и матричных величин, так что многомерные массивы и структуры придется просматривать, запуская из командной строки вывод самой переменной или какой-то ее части.

Если редактор medit вызван из командного окна, то в процессе вычислений редактирование становится невозможным. Чтобы в среде Windows подготавливать код (файлы сценариев и функций) параллельно вычислениям, можно запустить редактор medit автономно от MATLAB, но в этом случае просмотр данных будет невозможен.

Рассмотрим отладку с использованием средств редактора-отладчика. Назначения пунктов меню Debug приведены в таблице 2.5.

Таблица 2.5

Пункт меню|Описание
|---------|--------
Set/Clear Breakpoint F12|Расставить/убрать точку останова
Clear All Breakpoints|Убрать все точки останова
Step In F11|Построчное исполнение с заходом в вызываемые функции
Single Step F10|Построчное исполнение
Continue|Выполнение до следующей точки останова
Quit Debugging|Завершить отладку

Для отладки m-функции вызовем из командного окна редактор medit и считаем нужный файл. Чтобы указать точку останова в тексте функции, установим курсор на нужной строке и выполним пункт Set/Clear Breakpoint или щелкнем по отвечающему этому пункту значку. После расстановки точек останова запустим отлаживаемый файл. Пакет MATLAB выполнит все команды до первой точки и сделает паузу. Ниже можно просмотреть значения переменных. Пунткты указатели из меню откладки Debug (Таблица 2.6).

Таблица 2.6

Пункт меню|Описание
----------|--------
Stop If Error|Остановка при ошибке
Stop if Warning|Остановка при предупреждающем сообщении
Stop if NaN or Inf|Остановка при появлении нечисловой или бесконечной переменной
